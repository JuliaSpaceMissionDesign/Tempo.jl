<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Custom Timescales · Tempo.jl</title><meta name="title" content="Custom Timescales · Tempo.jl"/><meta property="og:title" content="Custom Timescales · Tempo.jl"/><meta property="twitter:title" content="Custom Timescales · Tempo.jl"/><meta name="description" content="Documentation for Tempo.jl."/><meta property="og:description" content="Documentation for Tempo.jl."/><meta property="twitter:description" content="Documentation for Tempo.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Tempo.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Tempo.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../t01_epochs/">Epochs</a></li><li class="is-active"><a class="tocitem" href>Custom Timescales</a><ul class="internal"><li><a class="tocitem" href="#Defining-a-New-Timescale"><span>Defining a New Timescale</span></a></li><li><a class="tocitem" href="#Extending-the-Default-Graph"><span>Extending the Default Graph</span></a></li><li><a class="tocitem" href="#Creating-a-Custom-Graph"><span>Creating a Custom Graph</span></a></li></ul></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../../api/">Public API</a></li><li><a class="tocitem" href="../../lapi/">Low-level API</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Custom Timescales</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Custom Timescales</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaSpaceMissionDesign/Tempo.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaSpaceMissionDesign/Tempo.jl/blob/main/docs/src/tutorials/t02_scales.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="tutorial_02_scales"><a class="docs-heading-anchor" href="#tutorial_02_scales">Creating Custom Timescales</a><a id="tutorial_02_scales-1"></a><a class="docs-heading-anchor-permalink" href="#tutorial_02_scales" title="Permalink"></a></h1><p>In Tempo.jl, all timescales connections and epoch conversions are handled through a <strong>directed graph</strong>.  A default graph (<a href="../../api/#Tempo.TIMESCALES"><code>TIMESCALES</code></a>), containing a set of predefined timescales is provided by this package. However, this package also provided a set of routines to either extend such graph or create a completely custom one. In this tutorial, we will explore both alternatives.</p><h2 id="Defining-a-New-Timescale"><a class="docs-heading-anchor" href="#Defining-a-New-Timescale">Defining a New Timescale</a><a id="Defining-a-New-Timescale-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-a-New-Timescale" title="Permalink"></a></h2><p>Custom timescales can be created with the <a href="../../api/#Tempo.@timescale"><code>@timescale</code></a> macro, which automatically creates the required types and structures, given the timescale acronym, an integer ID and, eventually, the full name of the timescale. </p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; @timescale ET 15 EphemerisTime</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p>The ID is an integer that is internally used to uniquely represent the timescale, whereas the acronym is used to alias such ID. It is also possible to define multiple acronyms associated to the same ID but you cannot assign multiple IDs to the same acronym. In case a full name is not provided, a default one will be built by appending <code>TimeScale</code> to the acronym.</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>The IDs from 1 to 10 are used to define the standard timescales of the package. To avoid unexpected behaviors, custom timescales should be registered with higher IDs.</p></div></div><p>In the previous example, we have created a custom timescale named <code>EphemerisTime</code>, with ID 15. We are now able to define epochs with respect to ET, but we cannot perform conversions towards other timescales until we register it in a graph system:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; ep = Epoch(20.425, ET)</code><code class="nohighlight hljs ansi" style="display:block;">2000-01-01T12:00:20.4249 ET</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; convert(TT, ep)</code><code class="nohighlight hljs ansi" style="display:block;">ERROR: EpochConversionError: cannot convert Epoch from the timescale Main.EphemerisTime to TerrestrialTime.</code></pre><h2 id="Extending-the-Default-Graph"><a class="docs-heading-anchor" href="#Extending-the-Default-Graph">Extending the Default Graph</a><a id="Extending-the-Default-Graph-1"></a><a class="docs-heading-anchor-permalink" href="#Extending-the-Default-Graph" title="Permalink"></a></h2><p>In this section, the goal is to register ET as a zero-offset scale with respect to <a href="../../api/#Tempo.TDB"><code>TDB</code></a>. To register this timescale in the default graph, we first need to define the offset functions of ET with respect to TDB: </p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; offset_tdb2et(sec::Number) = 0</code><code class="nohighlight hljs ansi" style="display:block;">offset_tdb2et (generic function with 1 method)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; offset_et2tdb(sec::Number) = 0</code><code class="nohighlight hljs ansi" style="display:block;">offset_et2tdb (generic function with 1 method)</code></pre><p>Since we have assumed that the two scales are identical, our functions will always return a zero offset. Rememeber that timescales graph is <strong>directed</strong>, meaning that if the user desires to go back and forth between two timescales, both transformations must be defined. The input argument of such functions is always the number of seconds since J2000 expressed in the origin timescale.</p><p>Finally, the <a href="../../api/#Tempo.add_timescale!"><code>add_timescale!</code></a> method can be used to register ET within the default graph:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; add_timescale!(TIMESCALES, ET, offset_tdb2et, parent=TDB, ftp=offset_et2tdb)</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p>If the inverse transformation (from ET to TDB) is not provided, only one-way epoch conversions will be allowed. We can now check that the desired timescale has been properly registered and performs the same as TDB: </p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; ep = Epoch(&quot;200.432 TT&quot;)</code><code class="nohighlight hljs ansi" style="display:block;">2000-07-19T22:22:04.8000 TT</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; convert(TDB, ep)</code><code class="nohighlight hljs ansi" style="display:block;">2000-07-19T22:22:04.7995 TDB</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; convert(ET, ep)</code><code class="nohighlight hljs ansi" style="display:block;">2000-07-19T22:22:04.7995 ET</code></pre><h2 id="Creating-a-Custom-Graph"><a class="docs-heading-anchor" href="#Creating-a-Custom-Graph">Creating a Custom Graph</a><a id="Creating-a-Custom-Graph-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-a-Custom-Graph" title="Permalink"></a></h2><p>To create a custom directed graph to handle timescales, Tempo.jl provides the <a href="../../api/#Tempo.TimeSystem"><code>TimeSystem</code></a> type. Therefore, let us define a new time transformation system called <code>TIMETRANSF</code>:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; const TIMETRANSF = TimeSystem{Float64}()</code><code class="nohighlight hljs ansi" style="display:block;">TimeSystem{Float64}(SMDGraphs.MappedNodeGraph{Tempo.TimeScaleNode{Float64}, Graphs.SimpleGraphs.SimpleDiGraph{Int64}}(Graphs.SimpleGraphs.SimpleDiGraph{Int64}(0, Vector{Int64}[], Vector{Int64}[]), Dict{Int64, Int64}(), Tempo.TimeScaleNode{Float64}[], Dict{Int64, Dict{Int64, Vector{Int64}}}(), Dict{Int64, Dict{Int64, Int64}}()))</code></pre><p>This object contains a graph and the properties associated to the new time-system defined in <code>TIMETRANSF</code>. At the moment, the computational graph is empty and we need to manually populate it with the new transformations.</p><p>We begin by creating a new timescale: </p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; @timescale DTS 1 DefaultTimeScale</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p>Once created, the new timescale is ready to be registered. If it is the first scale registered in the computational graph, nothing else than the type alias is needed and the registration can be performed as follows:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; add_timescale!(TIMETRANSF, DTS)</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; TIMETRANSF.scales.nodes</code><code class="nohighlight hljs ansi" style="display:block;">1-element Vector{Tempo.TimeScaleNode{Float64}}:
 TimeScaleNode{Float64}(name=DTS, id=1)</code></pre><p>Instead, in case the timescale is linked to a parent one, offset functions shall be defined. In this example, assume we want to register the timescales <code>NTSA</code> and <code>NTSB</code> such that <code>NTSA</code> has <code>DTS</code> as parent and a constant offset of 1 second, whereas<code>NTSB</code> has <code>NTSA</code> as parent and a linear offset with slope of 1/86400.</p><p>We begin by creating the first timescale:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; @timescale NTSA 2 NewTimeScaleA</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p>We then define its offset functions and register it in <code>TIMETRANSF</code> via the <a href="../../api/#Tempo.add_timescale!"><code>add_timescale!</code></a> method:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; const OFFSET_DTS_TO_NTSA = 1.0</code><code class="nohighlight hljs ansi" style="display:block;">1.0</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; offset_dts2ntsa(sec::Number) = OFFSET_DTS_TO_NTSA</code><code class="nohighlight hljs ansi" style="display:block;">offset_dts2ntsa (generic function with 1 method)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; offset_ntsa2dts(sec::Number) = -OFFSET_DTS_TO_NTSA</code><code class="nohighlight hljs ansi" style="display:block;">offset_ntsa2dts (generic function with 1 method)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; add_timescale!(TIMETRANSF, NTSA, offset_dts2ntsa, parent=DTS, ftp=offset_ntsa2dts)</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p>Now, if we have a look to the computational graph, we&#39;ll see that <code>NTSA</code> is registered:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; TIMETRANSF.scales.nodes</code><code class="nohighlight hljs ansi" style="display:block;">2-element Vector{Tempo.TimeScaleNode{Float64}}:
 TimeScaleNode{Float64}(name=DTS, id=1)

 TimeScaleNode{Float64}(name=NTSA, id=2, parent=1)</code></pre><p>If now we create a <code>DTS</code> epoch, we can leverage our custom time transformation system to convert it to an epoch in the <code>NTSA</code> timescale:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; e = Epoch(0.0, DTS)</code><code class="nohighlight hljs ansi" style="display:block;">2000-01-01T12:00:00.0000 DTS</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; convert(NTSA, e, system=TIMETRANSF)</code><code class="nohighlight hljs ansi" style="display:block;">2000-01-01T12:00:01.0000 NTSA</code></pre><p>Whenever the conversions are based on a custom time system, the graph must be provided as an additional argument to the <a href="../../lapi/#Base.convert"><code>convert</code></a> method. </p><p>To conclude the example, we will now add the <code>NTSB</code> scale but only register the <code>NTSA -&gt; NTSB</code> transformation:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; @timescale NTSB 3 NewTimeScaleB</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; offset_ntsa2ntsb(sec::Number) = sec/86400.0</code><code class="nohighlight hljs ansi" style="display:block;">offset_ntsa2ntsb (generic function with 1 method)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; add_timescale!(TIMETRANSF, NTSB, offset_ntsa2ntsb, parent=NTSA)</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p>Now, let&#39;s have a look to the nodes in the graph:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; TIMETRANSF.scales.nodes</code><code class="nohighlight hljs ansi" style="display:block;">3-element Vector{Tempo.TimeScaleNode{Float64}}:
 TimeScaleNode{Float64}(name=DTS, id=1)

 TimeScaleNode{Float64}(name=NTSA, id=2, parent=1)

 TimeScaleNode{Float64}(name=NTSB, id=3, parent=2)</code></pre><p>You can see that the new timescale has been registered with the desired integer ID <code>3</code>. To test the complete system, we will translate forwad of 2 days the previous epoch <code>e</code> and transform it in both timescales: </p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; e += 2*86400</code><code class="nohighlight hljs ansi" style="display:block;">2000-01-03T12:00:00.0000 DTS</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; ea = convert(NTSA, e, system=TIMETRANSF)</code><code class="nohighlight hljs ansi" style="display:block;">2000-01-03T12:00:01.0000 NTSA</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; eb = convert(NTSB, e, system=TIMETRANSF)</code><code class="nohighlight hljs ansi" style="display:block;">2000-01-03T12:00:03.0000 NTSB</code></pre><p>As expected, we obtain translations of 1 and 3 seconds, respectively.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../t01_epochs/">« Epochs</a><a class="docs-footer-nextpage" href="../../api/">Public API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Sunday 3 December 2023 20:10">Sunday 3 December 2023</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
