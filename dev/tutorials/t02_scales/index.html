<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Scales · Tempo.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Tempo.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../api/">API</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../t01_epochs/">Epochs</a></li><li class="is-active"><a class="tocitem" href>Scales</a><ul class="internal"><li><a class="tocitem" href="#Create-a-timescales-graph"><span>Create a timescales graph</span></a></li><li><a class="tocitem" href="#Create-a-new-timescale"><span>Create a new timescale</span></a></li><li><a class="tocitem" href="#Register-the-new-timescale"><span>Register the new timescale</span></a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Scales</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Scales</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaSpaceMissionDesign/Tempo.jl/blob/main/docs/src/tutorials/t02_scales.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="tutorial_02_scales"><a class="docs-heading-anchor" href="#tutorial_02_scales">Timescales graphs and extensions</a><a id="tutorial_02_scales-1"></a><a class="docs-heading-anchor-permalink" href="#tutorial_02_scales" title="Permalink"></a></h1><p>In <code>Tempo</code>, timescales are connected each other via a <strong>directed graph</strong>. Thanks to the  structure of the <code>Tempo</code> module, it is possible to either extend the current graph of  scales or create a completely custom one. Both of this possibilities are the subject of  this tutorial.</p><pre><code class="language-julia hljs">using Tempo</code></pre><h2 id="Create-a-timescales-graph"><a class="docs-heading-anchor" href="#Create-a-timescales-graph">Create a timescales graph</a><a id="Create-a-timescales-graph-1"></a><a class="docs-heading-anchor-permalink" href="#Create-a-timescales-graph" title="Permalink"></a></h2><p>To create a computational directed graph to handle timescales, <code>Tempo</code> provides the <code>TimeSystem</code> type. Therefore, let us define a new time transformation system called <code>TIMETRANSF</code>:</p><pre><code class="language-julia hljs">const TIMETRANSF = TimeSystem{Float64}()</code></pre><pre><code class="nohighlight hljs">TimeSystem{Float64}(MultiGraphs.MappedNodeGraph{Tempo.TimeScaleNode{Float64}, Graphs.SimpleGraphs.SimpleDiGraph{Int64}}(Graphs.SimpleGraphs.SimpleDiGraph{Int64}(0, Vector{Int64}[], Vector{Int64}[]), Dict{Int64, Int64}(), Tempo.TimeScaleNode{Float64}[], Dict{Int64, Dict{Int64, Vector{Int64}}}(), Dict{Int64, Dict{Int64, Int64}}()))</code></pre><p>This object contains a graph and the properties associated to the new time-system defined in <code>TIMETRANSF</code>. Note that the computational graph at the moment is empty, thus, we need to  manually populate it with the new transformations.</p><h2 id="Create-a-new-timescale"><a class="docs-heading-anchor" href="#Create-a-new-timescale">Create a new timescale</a><a id="Create-a-new-timescale-1"></a><a class="docs-heading-anchor-permalink" href="#Create-a-new-timescale" title="Permalink"></a></h2><p>In order to insert a new timescale to the graph, a new timescale type alias shall be defined. This can be easily done via the macro <code>@timescale</code>. This step requires 3 elements:</p><ul><li>The timescale acronym (user-defined).</li><li>The timescale index (it is an <code>Int</code> used to uniquely represent the timescale).</li><li>The timescale fullname.</li></ul><pre><code class="language-julia hljs">@timescale DTS 1 DefaultTimeScale</code></pre><h2 id="Register-the-new-timescale"><a class="docs-heading-anchor" href="#Register-the-new-timescale">Register the new timescale</a><a id="Register-the-new-timescale-1"></a><a class="docs-heading-anchor-permalink" href="#Register-the-new-timescale" title="Permalink"></a></h2><p>Once, created, the new timescale is ready to be registered. If it is the first scale registered in the computational graph, than, nothing else than the type alias is needed and the  registration can be performed as follows:</p><pre><code class="language-julia hljs">add_timescale!(TIMETRANSF, DTS)</code></pre><pre><code class="language-julia hljs">TIMETRANSF.scales.nodes</code></pre><pre><code class="nohighlight hljs">1-element Vector{Tempo.TimeScaleNode{Float64}}:
 TimeScaleNode{Float64}(name=DTS, id=1)</code></pre><p>Instead, in case the timescale is linked to a parent one, an offset function shall be defined. Remember that the computational graph is <strong>directed</strong>, i.e. the transformation to go back and  forth to the parent shall be defined if two-way transformations are desired.</p><p>In this example, assume we want to register timescale <code>NTSA</code> and a timescale <code>NTSB</code>.  <code>NTSA</code> has <code>DTS</code> as parent and a constant offset of 1 second. <code>NTSB</code> has <code>NTSA</code> has parent  and a linear offset with slope of 1/86400.</p><p>Then, first create the new scales:</p><pre><code class="language-julia hljs">@timescale NTSA 2 NewTimeScaleA
@timescale NTSB 3 NewTimeScaleB</code></pre><p>Now, let us define the offset functions for <code>NTSA</code>:</p><pre><code class="language-julia hljs">const OFFSET_DTS_TO_NTSA = 1.0
@inline offset_dts2ntsa(sec::Number) = OFFSET_DTS_TO_NTSA
@inline offset_ntsa2dts(sec::Number) = -OFFSET_DTS_TO_NTSA;</code></pre><p>We can now register <code>NTSA</code> to the computational graph using the <code>add_timescale!</code> method:</p><pre><code class="language-julia hljs">add_timescale!(TIMETRANSF, NTSA, offset_dts2ntsa, parent=DTS, ftp=offset_ntsa2dts)</code></pre><p>Now, if we have a look to the computational graph, we&#39;ll se that <code>NTSA</code> is registered:</p><pre><code class="language-julia hljs">TIMETRANSF.scales.nodes</code></pre><pre><code class="nohighlight hljs">2-element Vector{Tempo.TimeScaleNode{Float64}}:
 TimeScaleNode{Float64}(name=DTS, id=1)

 TimeScaleNode{Float64}(name=NTSA, id=2, parent=1)</code></pre><p>As well as, since we have registered both direct and inverse transformations, there is the  possibility to transform back and forth from <code>NTSA</code> to <code>DTS</code>. We can easily see this looking at the <code>paths</code> contained in the computational graph. Here the timescale are represented by means of the type-alias unique integer assigned during the creation of the new type. </p><pre><code class="language-julia hljs">TIMETRANSF.scales.paths</code></pre><pre><code class="nohighlight hljs">Dict{Int64, Dict{Int64, Vector{Int64}}} with 2 entries:
  2 =&gt; Dict(1=&gt;[2, 1])
  1 =&gt; Dict(2=&gt;[1, 2])</code></pre><p>If now we create a <code>DTS</code> epoch, it is possible to use the custom time transformation system to convert to <code>NTSA</code>:</p><pre><code class="language-julia hljs"># Create the new epoch 
# IMPORTANT: only J2000 seconds Epoch parser works with custom timescales.
e = Epoch(0.0, DTS)</code></pre><pre><code class="nohighlight hljs">2000-01-01T12:00:00.000 DTS</code></pre><pre><code class="language-julia hljs"># Call `convert` using the custom time transformation system 
convert(NTSA, e, system=TIMETRANSF)</code></pre><pre><code class="nohighlight hljs">2000-01-01T12:00:01.000 NTSA</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The <code>system</code> is an optimal output if the <code>Tempo</code> time transformation system is used.</p></div></div><p>To conclude the example, <code>NTSB</code> is has to be inserted. Let&#39;s assume that only the transformation <code>NTSA -&gt; NTSB</code> can be constructed. Then: </p><pre><code class="language-julia hljs"># Create the linear offset function
offset_ntsa2ntsb(sec::Number) = sec/86400.0
# Register the timescale to the computational graph
add_timescale!(TIMETRANSF, NTSB, offset_ntsa2ntsb, parent=NTSA)</code></pre><p>Now, let&#39;s have a look to the nodes in the graph:</p><pre><code class="language-julia hljs">TIMETRANSF.scales.nodes</code></pre><pre><code class="nohighlight hljs">3-element Vector{Tempo.TimeScaleNode{Float64}}:
 TimeScaleNode{Float64}(name=DTS, id=1)

 TimeScaleNode{Float64}(name=NTSA, id=2, parent=1)

 TimeScaleNode{Float64}(name=NTSB, id=3, parent=2)</code></pre><p>Where the new timescale has been registered with the alias <code>3</code>. Note however, that from <code>3</code> no transformations are available:</p><pre><code class="language-julia hljs">TIMETRANSF.scales.paths</code></pre><pre><code class="nohighlight hljs">Dict{Int64, Dict{Int64, Vector{Int64}}} with 3 entries:
  2 =&gt; Dict(3=&gt;[2, 3], 1=&gt;[2, 1])
  3 =&gt; Dict(2=&gt;[], 1=&gt;[])
  1 =&gt; Dict(2=&gt;[1, 2], 3=&gt;[1, 2, 3])</code></pre><p>To conclude, let&#39;s test the new time transformation system. Let&#39;s take the previous <code>Epoch</code>  translate forward of 2 days and transform to <code>NTSA</code> and <code>NTSB</code>. We should obtain a translation of <code>1 sec</code> and <code>3 sec</code> respectively:</p><pre><code class="language-julia hljs"># Translate the epoch
e += 2*86400</code></pre><pre><code class="nohighlight hljs">2000-01-03T12:00:00.000 DTS</code></pre><pre><code class="language-julia hljs"># Convert to `NTSA`
ea = convert(NTSA, e, system=TIMETRANSF)</code></pre><pre><code class="nohighlight hljs">2000-01-03T12:00:01.000 NTSA</code></pre><pre><code class="language-julia hljs"># Convert to `NTSB`
eb = convert(NTSB, e, system=TIMETRANSF)</code></pre><pre><code class="nohighlight hljs">2000-01-03T12:00:03.000 NTSB</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../t01_epochs/">« Epochs</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Wednesday 31 May 2023 09:19">Wednesday 31 May 2023</span>. Using Julia version 1.9.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
